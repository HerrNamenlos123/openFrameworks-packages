FROM debian:10

RUN apt-get update && apt-get upgrade -y
RUN apt-get install -y cmake git python3 ninja-build

ARG PACKAGE_NAME
ARG FULL_PACKAGE_NAME
ARG CC_COMPILER_PACKAGE
ARG CXX_COMPILER_PACKAGE
ARG CC_COMPILER
ARG CXX_COMPILER
ARG TOOLCHAIN_FILE

ENV PACKAGE_NAME=$PACKAGE_NAME
ENV FULL_PACKAGE_NAME=$FULL_PACKAGE_NAME
ENV CC_COMPILER_PACKAGE=$CC_COMPILER_PACKAGE
ENV CXX_COMPILER_PACKAGE=$CXX_COMPILER_PACKAGE
ENV CC_COMPILER=$CC_COMPILER
ENV CXX_COMPILER=$CXX_COMPILER
ENV TOOLCHAIN_FILE=$TOOLCHAIN_FILE

ENTRYPOINT [ "/bin/bash", "-c", "cd /repo && python3 -m packages.$PACKAGE_NAME.build" ]